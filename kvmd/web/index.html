<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>&pi;-kvm</title>
<style>
body {
	text-align: center;
}
.screen, .screen * {
	box-sizing: border-box;
}
.screen {
	display: inline-block;
	background-color: #e5e5f5;
	font-family: Arial, Tahoma, Verdana, sans;
	font-size: 10pt;
	text-align: center;
	padding: 1em;
	text-align: left;
}
.screen .screen-image {
	width: 720px;
	height: 576px;
	border: 1px solid #77d;
	display: inline-block;
}
</style>
</head>

<script>
ws = new WebSocket("ws://" + location.host + "/kvmd/ws");

function onWsMessage(message) {
	console.log(message.data);
	/*if (message.data == "EVENT mjpg_streamer started") {
		document.getElementById("stream-image").src = "/streamer/?action=stream&time=" + new Date().getTime();
	}*/
}

function onKeyEvent(event, state) {
	// TODO: run this code under the lock
	if (!event.metaKey) { // https://github.com/wesbos/keycodes/blob/gh-pages/scripts.js
		event.preventDefault();
	}
	console.log("Key", (state ? "pressed:" : "released:"), event)
	ws.send(JSON.stringify({
		event_type: "key",
		key: event.code,
		state: state,
	}));
}

ws.onmessage = (message) => onWsMessage(message);
ws.onerror = (error) => console.error(error);
ws.onclose = () => console.log("closed");

// https://www.codeday.top/2017/05/03/24906.html
document.onkeydown = (event) => onKeyEvent(event, true);
document.onkeyup = (event) => onKeyEvent(event, false);
</script>

<body>
<div class="screen">
	<img src="/streamer/?action=stream" id="stream-image" class="screen-image" alt="" />
</div>
</body>
</html>
